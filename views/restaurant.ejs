 <!DOCTYPE html>
<html>

<head>
	<title>Restaurants</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="../stylesheets/homepage.css">
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" type="text/css" href="../stylesheets/menustyle.css">
  <link rel="stylesheet" type="text/css" href="../stylesheets/alert.css">
  <link rel="stylesheet" type="text/css" href="../stylesheets/duDialog.css">
  <link rel="icon" href="../images/xlogo.png">
<meta name="theme-color" content="#A7F25C">
<meta name="msapplication-navbutton-color" content="#A7F25C">
<meta name="apple-mobile-web-app-status-bar-style" content="#A7F25C">

<style>

	input,.tn {
	text-align: center;
  border: none;
  border-radius: 32px;
  margin: 10px;
  background-color: #afff8c;
  outline: none;
  }
  .row{margin:0px;}
  .btn-primary:hover{background:#afff8c}
  input:hover,.btn:hover {
  opacity: 1;
  }
  input[type=submit] {
  background-color: #ff8026;
  color: white;
  cursor: pointer;
  font-family: Raleway;}
input[type=text] {
  background-color: #afff8c;
  opacity: 1;
  margin: 0;
  width: 100%;
  font-family: Raleway;

}
input[type=submit]:hover {
  background-color: #d64d1b;
}
#option{
  color: black;
  background: white;
  border-radius: 20px;
  margin: 20px;
  padding: 20px;
  box-shadow: 0px 0px 10px #bdbdbd;
  width:20%;
  height:160px;
}
.btn-primary{
  background-color: #afff8c;
  color:green;
  width: 100%;
}
@media screen and (max-width: 991px)
{
#option{
  border-radius: 0px;
  margin: 0px;
  padding: 10px;
  box-shadow:none;
  width: 100%;
}
.btn-primary{
  color:green;
  width:fit-content;
}
input[type=text] {
  width:min-content;
  opacity: 1;
  margin: 0;
}
}

</style>
</head>
<body style=" background:#f1f1f1">
<div id="header">
  <nav class="navbar navbar-default" style="background-color:#A7F25C;position:fixed;width:100%;z-index:9;box-shadow:0px 0px 10px black; border: none;">
		<div class="container-fluid xnav">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/home"><b>Xappal</b></a>
			</div>
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li><a href="mailto:xappalcare@gmail.com">Contact</a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
						<% if(!currentUser){%>
					<li><a href="/register">Sign up</a></li>
					<li><a href="/login">Log in</a></li>
					<%}else{%>

					<li><a href="#" id="Sign">Signed in as <%=currentUser.username%></a></li>
					<li><a href="/logout">Log out</a></li>
					<%}%>
				  </ul>
			</div>
		</div>
	</nav>
  <%if(error&&error.length>0){%>
  <div class="alert alert-danger" role="alert">

      <%=error%>
      </div>
      <%}if(success&&success.length>0){%>
      <div class="alert alert-success" role="alert">
        <%=success%>
      </div>
      <%}%>
</div>
</div>
<div>
	<div class="container restpic">
    <div class="row">
      <div class="col-xs-6" id="option">
  <h3>DELIVERY</h3>
  <div class="dropdown">
     <button class="btn btn-primary dropdown-toggle btn-lg green" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="address" style="">
    <!-- a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" > -->
    Select College
    <span class="caret"></span>
    <!-- </a> -->
    </button>
    <ul class="dropdown-menu"  style="border-radius: 20px;">
      <li><a href="#" onclick="selloc('Delivering to: IIT')">IIT</a></li>
      <li><a href="#" onclick="selloc('Delivering to: NLU')">NLU</a></li>
      <li><a href="#" onclick="selloc('Delivering to: NIFT')">NIFT</a></li>
      <li><a href="#" onclick="selloc('Delivering to: FDDI')">FDDI</a></li>
    </ul>
  </div>
</div>
      <div class="resttext col-lg-6 col-md-6 col-sm-12">
	       <h1><strong><%=restro.name%></strong></h1>
	       <hr class="style-one">
	       <p><%=restro.desc%></p>
      </div>
    </div>
	</div>
<div class="row"style="width:100%">
<div class="col-xs-6" id="option">
<h3>Timings</h3>
<div class="dropdown">
				    <button class="btn btn-primary dropdown-toggle btn-lg green" type="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false" id="timesel">
						<!-- a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" > -->
								Select Timings
								<span class="caret"></span>
							<!-- </a> -->
						</button>
            <ul class="dropdown-menu" style="border-radius: 20px;">
							<li id="time2"><a href="#" onclick="timedev(2)">2pm</a></li>
							<li id="time5"><a href="#" onclick="timedev(5)">5pm</a></li>
							<li id="time7" ><a href="#" onclick="timedev(7)">7pm</a></li>
							<li  id="time10"><a href="#" onclick="timedev(10)">10pm</a></li>
						</ul>
        </div>
</div>
<div class="col-xs-6" id="option">
  <h3>Delivery</h3>
	<input type="text" name="Flat/Room no." placeholder="Delivery address" class="btn btn-lg" id="roomdet" onkeyup="room()" style="border-radius: 32px;text-align: left;height: 36px;outline:none;margin: 7px;color:green; font-size:initial;" required>
</div>
<div class="col-xs-6" id="option">
	<h3>Payment</h3>
	<div class="dropdown">
		<button class="btn btn-primary dropdown-toggle btn-lg green" type="button" data-toggle="dropdown" aria-haspopup="true"
		aria-expanded="false" id="payet">
			Mode of Payment
  	</button>
			<ul class="dropdown-menu" style="width: 100%">
				<li id="time7" ><a href="#" onclick="payme('CASH')" style="color: black" >CASH</a></li>
				<li  id="time10"><a href="#" onclick="payme('PAYTM')" style="color: black">PAYTM</a></li>
			</ul>
	</div>
</div>
</div>
<hr class="style-one">
  <div class="row">
  <div class="col-sm-8">
	<span class="menu">
  <h3 style="text-align: center;">CATALOGUE</h3>
  <%restro.menu.sort(function(a, b){var nameA = a.itname.toUpperCase();var nameB = b.itname.toUpperCase(); if (nameA < nameB) {return -1;}if (nameA > nameB) {return 1;}return 0;});var x=0;restro.menu.forEach((item)=>{if(item.veg==="VEG"){%>
  <button type="button" class="btn btn-info btn-lg dish veg" data-toggle="modal" data-target="#<%=item._id%>" ><%=item.itname%></button>
		<%}else{%>
  <button type="button" class="btn btn-info btn-lg dish non-veg" data-toggle="modal" data-target="#<%=item._id%>" ><%=item.itname%></button>
			<%}%>
  <span>

    <div class="modal fade" id="<%=item._id%>" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title"><%=item.itname%></h4>
          </div>
          <div class="modal-body">
            <p><span style="font-weight:800">INR <%=item.price%> /-</p>
          	<p>Some details</p>
          </div>
          <div class="modal-footer qt">
       	    <span class="qt">Quantity <input type="number" id="<%=x%>" value="1" min="1"> </span>
            <button type="button" class="btn btn-primary menu" onclick="add('<%=item.itname%>',<%=item.price%>,document.getElementById('<%=x%>'))">Add to Cart</button>
        <!-- ADD -->

          </div>
        </div>
      </div>
    </div>
  </span>
  <%x++;});%>
  </span>

</div>
  <div class="col-sm-4">
    <div class="CART" style="text-align: center;">
      <div class="modal-content">
        <div class="modal-header"><h4 class="modal-title">CART</h4></div>
          <div class="modal-body menumodal">
              <table width="100%" id="cart">
                <tr>
                  <td>Item Name</td>
                  <td>Quantity</td>
                  <td>Price</td>
                </tr>
              </table>
            <div class="modal-footer qt">
                <button class="menu btn btn-primary" id="checkout" type="reset" name="order" onclick="checkout('<%=currentUser.username%>','<%=restro.name%>','<%=restro._id%>')" style="float:right;padding:10px;">CHECKOUT Rs. <span id="total">0</span></button>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<br>
      <footer id="myFooter">
          <div class="container">
              <div class="row">
                  <div class="col-sm-3">
  				<a href="#"><img src="../images/mainlogo.png" width="200px"></a>
                  </div>
                  <div class="col-sm-2">
                      <h5>Get started</h5>
                      <ul>
                          <li><a href="/home">Home</a></li>
                          <li><a href="/register">Sign up</a></li>
                          <li><a href="\login">Log in</a></li>
                      </ul>
                  </div>
                  <div class="col-sm-2">
                      <button data-toggle="modal" data-target="#myModal" class="about"><h5>About Us</h5></button>

  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <div class="modal-content"  style="color: black">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">About US</h4>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
                    <ul>
                        <li><a href="mailto:xappalcare@gmail.com">Email</a></li>
                      </ul>
                  </div>
                  <div class="col-sm-2">
                      <h5>Support</h5>
                      <ul>
                        <li><a href="tel:#">Give a call</a></li>
                      </ul>
                  </div>
                  <div class="col-sm-3">
                      <div class="social-networks">
                          <a target="_blank" href="https://www.twitter.com/xappal1" class="twitter"><i class="fa fa-twitter"></i></a>
                        <a target="_blank" href="https://www.instagram.com/xappalofficial" class="instagram"><i class="fa fa-instagram"></i></a>
                      </div>
                  </div>
              </div>
          </div>
          <div class="footer-copyright">
              <p>Â© 2019 Copyright </p>
          </div>
      </footer>


		<!-- SCRIPTS -->
		<script>
		var arr=new Array();
		var bill = 0;
		var final = "";
		var a="",b="",c="",d="",e="",f="",g="";
		var count=0;

		function add(x, y, z) {

			bill = bill + y * (z.value);
			console.log(x);
			var str = "";
			var itname=x;
			var len = str.length;
			str = itname + " " + " x " + z.value + " = " + y * z.value;
			console.log(str);
			var co={
				itname:itname,
				price:y*z.value,
				qty:z.value
			}
			arr.push(co);

			$("#cart").append("<tr id='item"+count+"'><td>" + itname + "</td><td>"+z.value+  "</td><td>"+y * z.value+"</td><td><button class='btn btn-danger' onclick=removeitem("+count+")>remove</td></tr>");
			$("#total").text(bill);
			console.log(arr);
			count++;
		}
		function removeitem(num){
			var minus=arr[num].price;
			console.log(num);
			console.log(minus);

			console.log(arr);
			bill=bill-minus;
			console.log(bill);
			$("#total").text(bill);
			arr[num].itname="nullified";
			arr[num].qty=0;
			arr[num].price=0;
			$("#item"+num).remove();
		}
		function selloc(loc){
			document.querySelector("#address").textContent=loc;
			c=loc;
		}
		function timedev(time){
			document.querySelector("#timesel").textContent=time+"pm";
			e=time;
		}
		function checkout(a1,b1,d1){
			a=a1;
			b=b1;
			d=d1;
		}
		function payme(sc){
			f=sc;
			document.querySelector("#payet").textContent=f;
		}
		function room(){
			g=document.getElementById("roomdet").value;
		}
		var today=new Date();
		var currentOffset = today.getTimezoneOffset();

		var ISTOffset = 330;   // IST offset UTC +5:30

		var ISTTime = new Date(today.getTime() + (ISTOffset + currentOffset)*60000);
		var currenttimeHours=ISTTime.getHours();
		var currenttimeMin=ISTTime.getMinutes();
		console.log(currenttimeHours+ "" +currenttimeMin);
		if((currenttimeHours==13&&currenttimeMin>=15)||currenttimeHours>=14)
		{document.querySelector("#time2").style.visibility="hidden";}
		if((currenttimeHours==16&&currenttimeMin>=15)||currenttimeHours>=17)
		{document.querySelector("#time5").style.visibility="hidden";}
		if((currenttimeHours==18&&currenttimeMin>=15)||currenttimeHours>=19)
		{document.querySelector("#time7").style.visibility="hidden";}
		if((currenttimeHours==21&&currenttimeMin>=15)||currenttimeHours>=22)
		{document.querySelector("#time10").style.visibility="hidden";}
		document.querySelector("#checkout").addEventListener("click", () => {
			if(c===""||e===""){
				new duDialog('Alert Message', 'Delivery details missing !!!');
				}
			else if(bill==0){
				new duDialog('Alert Message', "Select something First");

			}
			else{
	new duDialog('Confirm Dialog', 'Are you sure you want to order?', duDialog.OK_CANCEL, {
    okText: 'Order Now',
    callbacks: {
    okClick: function(){
    //   {$.post("/checkout",{restro:b,custo:a,loc:c,bill:bill,order:arr,slot:e,pay:f,room:g},(result)=>{
	// 			console.log(result);
	// 		},)}
	$.ajax({url:"/checkout",timeout:10000,type:"POST",contentType:"application/json",data:JSON.stringify({restro:b,custo:a,loc:c,bill:bill,order:arr,slot:e,pay:f,room:g}),success:(result,text,jqxhr)=>{
		new duDialog('Alert Message', 'Your Order has been Confirmed');


			location.href="/thanks";

	},error:(x,y,error)=>{console.log(error)}});
			this.hide();
      },
      cancelClick: function(){
		console.log("order cancelled");
		this.hide();
      }
    }
})
		}
		})



    var sign = document.getElementById("Sign");
    var bool = true;
    sign.addEventListener("click",function(){
      if(bool){
      sign.textContent = "<%=currentUser.username%>";
      bool = false;
      }
      else{
      sign.textContent = "Signed in as <%=currentUser.username%>";
      bool = true;
      }
    });
	</script>
	<script src="popupS.js"></script>
	<script src="../stylesheets/duDialog.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body>
</html>
